#!/bin/sh
PIDFILE=${nginx:location}/logs/nginx.pid
case "$1" in
    start)
        if [ ! -d ${buildout:directory}/var/nginx/cache ]; then
            mkdir -p ${buildout:directory}/var/nginx/cache
        fi
        if [ ! -d ${buildout:directory}/var/temp ]; then
            mkdir -p ${buildout:directory}/var/temp
        fi
        if [ ! -d ${buildout:directory}/var/nginx/client_body_temp ]; then
            mkdir -p ${buildout:directory}/var/nginx/client_body_temp
        fi
        shift
        # pass arguments to nginx to allow ``-g "daemon off;"`` from supervisor
        exec ${nginx:location}/sbin/nginx \
            -c ${buildout:directory}/etc/nginx/main.conf \
            "$@"
        ;;
    stop)
        kill -QUIT `cat $PIDFILE`
        ;;
    reload)
        kill -HUP `cat $PIDFILE`
        ;;
    newlogs)
        kill -USR1 `cat $PIDFILE`
        ;;
    restart|force-reload)
        $0 stop
        sleep 1
        $0 start
        ;;
    *)
        echo "Usage: $SCRIPTNAME {start|stop|restart|reload|force-reload|newlogs}" >&2 
        exit 1
        ;;
esac


